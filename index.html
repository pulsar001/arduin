<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Afficheur</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="#">Afficheur température, humidité et luminosité</a>
      </div>
    </nav>

    <div class="container my-5">
        <div class="row">

            <div class="col-4 px-2">
                <h2>Température</h2>
                <p class="fs-5">Valeur actuelle: <span id="valeurTemperature"></span> °C</p>

                <hr class="col-12 my-4">

                <div class="chartjs-custom" height="10vh" width="20vw">
                    <canvas id="chartTemperature"></canvas>
                </div>

                <hr class="col-12 my-4">

                <textarea rows="20" class="form-control" readonly id="historiqueTemperature">
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
                </textarea>
            </div>

            <div class="col-4 px-2">
                <h2>Humidité</h2>
                <p class="fs-5">Valeur actuelle: <span id="valeurHumidite"></span> %</p>

                <hr class="col-12 my-4">

                <div class="chartjs-custom" height="10vh" width="20vw">
                    <canvas id="chartHumidite"></canvas>
                </div>

                <hr class="col-12 my-4">

                <textarea rows="20" class="form-control" readonly id="historiqueHumidite">
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
                </textarea>
            </div>

            <div class="col-4 px-2">
                <h2>Luminosité</h2>
                <p class="fs-5">Valeur actuelle:  <span id="valeurLuminosite"></span> %</p>

                <hr class="col-12 my-4">

                <div class="chartjs-custom" height="10vh" width="20vw">
                    <canvas id="chartLuminosite"></canvas>
                </div>

                <hr class="col-12 my-4">

                <textarea rows="20" class="form-control" readonly id="historiqueLuminosite">
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
[19:01:11] Température 10 °C
                </textarea>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.1.1/chart.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <script>



        
        var chartDataTemperature = {
            "labels": [],
            "datasets": [{
                "data": [],
                "backgroundColor": ["rgba(55, 125, 255, 0)", "rgba(255, 255, 255, 0)"],
                "borderColor": "#377dff",
                "borderWidth": 2,
                "pointRadius": 0,
                "pointHoverRadius": 0
            }]
        };
        var chartDataHumidite = {
            "labels": [],
            "datasets": [{
                "data": [],
                "backgroundColor": ["rgba(55, 125, 255, 0)", "rgba(255, 255, 255, 0)"],
                "borderColor": "#377dff",
                "borderWidth": 2,
                "pointRadius": 0,
                "pointHoverRadius": 0
            }]
        };
        var chartDataLuminosite = {
            "labels": [],
            "datasets": [{
                "data": [],
                "backgroundColor": ["rgba(55, 125, 255, 0)", "rgba(255, 255, 255, 0)"],
                "borderColor": "#377dff",
                "borderWidth": 2,
                "pointRadius": 0,
                "pointHoverRadius": 0
            }]
        };

        var chartOptions = {
            "responsive": true,
            "scales": {
                "y": {
                    "display": true,
                    // "type": 'logarithmic',
                },
                "x": {
                    "display": true,
                }
            },
            "hover": {
                "mode": "nearest",
                "intersect": false
            },
            "plugins": {
                "tooltip": {
                    "postfix": "k",
                    "hasIndicator": true,
                    "intersect": false
                },
                "legend": {
                    "display": false,
                }
            }
        };


        const ctxTemperature = document.getElementById('chartTemperature');
        var chartTemperature = new Chart(ctxTemperature, {
                "type": "line",
                "data": chartDataTemperature,
                "options": chartOptions
        });
        
        setInterval(function() {
            let value1 = Math.floor(Math.random() * (100 - 1)) + 1;
            let value2 = Math.floor(Math.random() * (100 - 1)) + 1;
            addData(chartTemperature, parseInt(value1), parseInt(value2));
            removeData(chartTemperature);
        }, 1000);

        const ctxHumidite = document.getElementById('chartHumidite');
        var chartHumidite = new Chart(ctxHumidite, {
                "type": "line",
                "data": chartDataHumidite,
                "options": chartOptions
        });

        setInterval(function() {
            let value1 = Math.floor(Math.random() * (100 - 1)) + 1;
            let value2 = Math.floor(Math.random() * (100 - 1)) + 1;
            addData(chartHumidite, parseInt(value1), parseInt(value2));
            removeData(chartHumidite);
        }, 1000);

        const ctxLuminosite = document.getElementById('chartLuminosite');
        var chartLuminosite = new Chart(ctxLuminosite, {
                "type": "line",
                "data": chartDataLuminosite,
                "options": chartOptions
        });

        setInterval(function() {
            let value1 = Math.floor(Math.random() * (100 - 1)) + 1;
            let value2 = Math.floor(Math.random() * (100 - 1)) + 1;
            addData(chartLuminosite, parseInt(value1), parseInt(value2));
            removeData(chartLuminosite);
        }, 1000);



        function addData(chart, label, data) {
            chart.data.labels.push(label);
            chart.data.datasets.forEach((dataset) => {
                dataset.data.push(data);
            });
            chart.update();
        }

        function removeData(chart) {
            if (chart.data.datasets[0].data.length > 50) {
                chart.data.labels.shift();
                chart.data.datasets.forEach(dataset => {
                    dataset.data[0] = dataset.data[1]
                    dataset.data.splice(1, 1)
                })
                chart.update();
            }
        }


    </script>
    

    <script>
        window.bridge.sendSettings((event, settings) => {
            console.log(settings);
        });
    </script>
  </body>
</html>